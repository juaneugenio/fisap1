# FlAp1 Cards - A Vanilla JS Flashcard Application

FlAp1 Cards is a lightweight, performant, and secure web-based flashcard application built with vanilla JavaScript, HTML, and CSS. It uses Supabase for its backend, including database, authentication, and file storage.

## Features

- **Fast, On-Demand Loading**: The main view loads instantly, fetching cards only when a category is selected or a search is performed.
- **Secure Admin Panel**: A complete CRUD (Create, Read, Update, Delete) interface for managing flashcards and categories.
- **Role-Based Access Control (RBAC)**: The admin panel is protected by a robust security model. Write operations are restricted to `admin` users at the database level using Supabase's Row Level Security (RLS) and secure `app_metadata`.
- **Rich Text Editing**: Card content is managed via the Quill.js rich text editor.
- **Direct Image Uploads**: Images can be uploaded directly from the editor to a Supabase Storage bucket.
- **Favorites System**: Users can mark their favorite cards, and this state is persisted in the browser's LocalStorage.
- **Database Integrity**: The database schema is designed with foreign key constraints (`ON DELETE CASCADE`, `ON UPDATE CASCADE`) to ensure data consistency.
- **Clean & Maintainable Code**: Follows modern JavaScript practices, such as separation of concerns (HTML/CSS/JS) and event listeners over inline handlers.

## Tech Stack

- **Frontend**: HTML5, CSS3, Vanilla JavaScript
- **Backend**: Supabase (PostgreSQL, Auth, Storage)
- **Libraries**:
  - Quill.js: For the rich text editor.
  - DOMPurify: For sanitizing HTML and preventing XSS attacks.

## Project Setup

To run this project locally, you'll need a Supabase account.

1.  **Clone the repository:**

    ```bash
    git clone https://github.com/your-username/your-repo-name.git
    cd your-repo-name
    ```

2.  **Create `supabase.js` file:**
    In the root of the project, create a file named `supabase.js` and add your Supabase project credentials:

    ```javascript
    const SUPABASE_URL = "YOUR_SUPABASE_URL";
    const SUPABASE_KEY = "YOUR_SUPABASE_ANON_KEY";

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    ```

3.  **Supabase Database Setup:**
    Go to the SQL Editor in your Supabase project and run the following queries to create the necessary tables and relationships.
    - **Create `categories` table:**

      ```sql
      CREATE TABLE public.categories (
        id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
        name TEXT NOT NULL,
        CONSTRAINT categories_name_key UNIQUE (name)
      );
      ```

    - **Create `cards` table:**
      ```sql
      CREATE TABLE public.cards (
        id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
        category TEXT NOT NULL,
        tags TEXT,
        front_title TEXT NOT NULL,
        front_content TEXT,
        back_content TEXT NOT NULL,
        updated_at TIMESTAMPTZ,
        CONSTRAINT fk_cards_category FOREIGN KEY (category) REFERENCES public.categories (name) ON UPDATE CASCADE ON DELETE CASCADE
      );
      ```

4.  **Supabase Storage Setup:**
    - Go to the **Storage** section in your Supabase project.
    - Create a new **public** bucket named `card-images`.

5.  **Security (RLS) Setup:**
    - Go to the SQL Editor and run the policies provided in the project documentation to enable Row Level Security. This will ensure only admins can modify data.

6.  **Create an Admin User:**
    - Disable new user sign-ups in **Authentication -> Providers**.
    - Create a user manually in the **Authentication -> Users** section.
    - Use a `cURL` command with your `service_role` key to securely assign the `admin` role to this user's `app_metadata`. Refer to the Supabase documentation for updating user data via the Admin API.

## Project Structure

- `index.html`: The main public-facing page for viewing flashcards.
- `app.js`: Logic for the public-facing `index.html` (fetching/rendering cards).
- `admin.html`: The admin panel for managing content.
- `admin.js`: Logic for the `admin.html` panel (CRUD operations, auth).
- `style.css`: All styles for the application.
- `supabase.js`: Supabase client configuration.
