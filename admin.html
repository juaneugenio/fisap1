<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - FlashLearn</title>
    <link
      href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="login-overlay">
      <h2>Admin Access</h2>
      <input
        type="password"
        id="passInput"
        style="max-width: 280px; margin-bottom: 15px"
        placeholder="Enter password"
      />
      <div class="btn-group" style="width: 280px">
        <button class="btn" onclick="checkPass()">Login</button>
        <button
          class="btn btn-home"
          onclick="window.location.href = 'index.html'"
        >
          Exit
        </button>
      </div>
    </div>

    <div id="modal-overlay">
      <div class="modal">
        <h3>¡Tarjeta Guardada!</h3>
        <p>¿Deseas crear otra tarjeta ahora mismo?</p>
        <div class="btn-group">
          <button class="btn" onclick="resetForNew()">SÍ</button>
          <button
            class="btn btn-home"
            onclick="window.location.href = 'index.html'"
          >
            NO (Home)
          </button>
        </div>
      </div>
    </div>

    <div class="admin-container">
      <h2 style="margin: 20px 0">Create Flashcard</h2>
      <form id="cardForm">
        <div class="form-section">
          <label>Category</label>
          <select id="categorySelect">
            <option value="">-- Select Category --</option>
            <option value="Projektmanagement">Projektmanagement</option>
            <option value="Datenschutz">Datenschutz</option>
            <option value="IT-Sicherheit">IT-Sicherheit</option>
            <option value="Qualitätsmanagement">Qualitätsmanagement</option>
          </select>
        </div>
        <div class="form-section">
          <label>Tags</label>
          <input type="text" id="tags" placeholder="scrum, tech, security" />
        </div>
        <div class="form-section">
          <label>Frontside (Question/Title)</label>
          <div id="editor-front" style="background: white; color: black"></div>
        </div>
        <div class="form-section">
          <label>Backside (Answer/Details)</label>
          <div id="editor-back" style="background: white; color: black"></div>
        </div>

        <div class="btn-group">
          <button type="submit" class="btn">SAVE CARD</button>
          <button
            type="button"
            class="btn btn-cancel"
            onclick="window.location.href = 'index.html'"
          >
            CANCEL
          </button>
        </div>
      </form>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
      const quillConfig = {
        theme: "snow",
        modules: {
          toolbar: [
            [{ header: [1, 2, 3, false] }],
            ["bold", "italic", "underline"],
            [{ color: [] }, { background: [] }],
            [{ list: "ordered" }, { list: "bullet" }],
            [{ align: [] }],
            ["blockquote", "code", "code-block"],
            ["link", "image"],
            ["clean"],
          ],
        },
      };

      const qFront = new Quill("#editor-front", quillConfig);
      const qBack = new Quill("#editor-back", quillConfig);

      function checkPass() {
        if (document.getElementById("passInput").value === "1234") {
          document.getElementById("login-overlay").style.display = "none";
        } else {
          alert("Wrong password");
        }
      }

      document
        .getElementById("cardForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const cat = document.getElementById("categorySelect").value;
          const tags = DOMPurify.sanitize(
            document.getElementById("tags").value,
          );
          const frontHtml = DOMPurify.sanitize(qFront.root.innerHTML.trim(), {
            ADD_ATTR: ["style"],
          });
          const backHtml = DOMPurify.sanitize(qBack.root.innerHTML.trim(), {
            ADD_ATTR: ["style"],
          });

          const isFrontEmpty =
            qFront.getText().trim().length === 0 && !frontHtml.includes("<img");
          const isBackEmpty =
            qBack.getText().trim().length === 0 && !backHtml.includes("<img");

          if (!cat || !tags || isFrontEmpty || isBackEmpty) {
            alert("Rellena todos los campos");
            return;
          }

          console.log("Guardado:", { cat, tags, frontHtml, backHtml });
          document.getElementById("modal-overlay").style.display = "flex";
        });

      function resetForNew() {
        document.getElementById("modal-overlay").style.display = "none";
        document.getElementById("cardForm").reset();
        qFront.setContents([]);
        qBack.setContents([]);
        window.scrollTo(0, 0);
      }
    </script>
  </body>
</html>
